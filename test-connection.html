<!DOCTYPE html>
<html>
<head>
    <title>Test Frontend-Backend Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .job-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f9f9f9;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ProConnect Health - Connection Test</h1>
    
    <h2>Backend Connection Tests</h2>
    <div id="health-status"></div>
    <div id="jobs-status"></div>
    <div id="stats-status"></div>
    
    <h2>Jobs Retrieved</h2>
    <div id="jobs-list"></div>
    
    <h2>Raw API Response</h2>
    <pre id="raw-response"></pre>

    <script>
        const API_URL = 'http://localhost:5001';
        
        // Test Health Endpoint
        async function testHealth() {
            const statusDiv = document.getElementById('health-status');
            try {
                const response = await fetch(`${API_URL}/api/health`);
                const data = await response.json();
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `‚úÖ Health Check: ${data.message} (Version: ${data.version})`;
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå Health Check Failed: ${error.message}`;
            }
        }
        
        // Test Jobs Endpoint
        async function testJobs() {
            const statusDiv = document.getElementById('jobs-status');
            const jobsList = document.getElementById('jobs-list');
            const rawResponse = document.getElementById('raw-response');
            
            try {
                const response = await fetch(`${API_URL}/api/jobs`);
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `‚úÖ Jobs API: Retrieved ${data.jobs.length} jobs`;
                    
                    // Display raw response
                    rawResponse.textContent = JSON.stringify(data, null, 2);
                    
                    // Display jobs
                    jobsList.innerHTML = data.jobs.map(job => `
                        <div class="job-card">
                            <h3>${job.title}</h3>
                            <p><strong>Facility:</strong> ${job.facility}</p>
                            <p><strong>Location:</strong> ${job.location}</p>
                            <p><strong>Department:</strong> ${job.department}</p>
                            <p><strong>Shift:</strong> ${job.shiftType}</p>
                            <p><strong>Salary:</strong> ${job.salary}</p>
                            <p><strong>Sign-On Bonus:</strong> ${job.signOnBonus || 'N/A'}</p>
                            <p><strong>Nurse-Patient Ratio:</strong> ${job.nursePatientRatio || 'N/A'}</p>
                            <p><strong>Urgent Need:</strong> ${job.urgentNeed ? 'üö® YES' : 'No'}</p>
                            <p><strong>Verified:</strong> ${job.verified ? '‚úÖ Verified' : '‚ùå Not Verified'}</p>
                        </div>
                    `).join('');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = `‚ùå Jobs API Failed: ${data.error}`;
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå Jobs API Error: ${error.message}`;
                console.error('Full error:', error);
            }
        }
        
        // Test Stats Endpoint
        async function testStats() {
            const statusDiv = document.getElementById('stats-status');
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `‚úÖ Stats API: ${data.totalJobs.toLocaleString()} total jobs | ${data.verifiedHospitals.toLocaleString()} hospitals | ${data.placementRate} placement rate`;
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå Stats API Failed: ${error.message}`;
            }
        }
        
        // Run all tests
        async function runAllTests() {
            console.log('Starting connection tests...');
            await testHealth();
            await testJobs();
            await testStats();
            console.log('Tests complete. Check the page for results.');
        }
        
        // Run tests on page load
        runAllTests();
        
        // Also test from frontend perspective
        console.log('Testing CORS by checking if frontend at :3007 can access backend at :5001');
    </script>
</body>
</html>